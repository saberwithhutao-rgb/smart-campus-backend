spring:
  mvc:
    throw-exception-if-no-handler-found: true  # ğŸŸ¢ å¿…é¡»æ·»åŠ ï¼
  web:
    resources:
      add-mappings: false  # ğŸŸ¢ ç¦ç”¨é»˜è®¤çš„é™æ€èµ„æºæ˜ å°„
  # æ•°æ®æºé…ç½® - ä½¿ç”¨ä½ çš„å®é™…ç”¨æˆ·åå’Œå¯†ç 
  datasource:
    url: jdbc:postgresql://localhost:5432/smart_campus
    username: smartcampus_app
    password: SmartCampus2024
    hikari:
      pool-name: SmartCampusHikariPool
      maximum-pool-size: 20
      minimum-idle: 10
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      leak-detection-threshold: 60000
#      connection-test-query: SELECT 1
      data-source-properties:
        ssl: false
        socketTimeout: 30
        loginTimeout: 10
        tcpKeepAlive: true
        readOnly: false

  # JPAé…ç½®
  jpa:
    hibernate:
      ddl-auto: validate  # ç”Ÿäº§ç¯å¢ƒç”¨validateï¼Œä¸ç”¨update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          batch_size: 20
          fetch_size: 50
        order_inserts: true
        order_updates: true
        batch_versioned_data: true
    open-in-view: false  # ç”Ÿäº§ç¯å¢ƒå…³é—­

  # é‚®ä»¶é…ç½®
  mail:
    host: ${MAIL_HOST:gz-smtp.qcloudmail.com}
    port: ${MAIL_PORT:465}
    username: ${MAIL_USERNAME:noreply@55kjikj.xyz}
    password: ${MAIL_PASSWORD:NagatoYuki154}
    protocol: smtps
    properties:
      mail:
        smtp:
          auth: true
          ssl:
            enable: true  # 465ç«¯å£å¿…é¡»å¯ç”¨SSL
          connectiontimeout: 10000
          timeout: 10000
          writetimeout: 10000

  # Redisé…ç½®
  data:
    redis:
      host: localhost
      port: 6379
      timeout: 5000
      database: 1  # ä½¿ç”¨1å·åº“å­˜å‚¨AIç¼“å­˜

  # æ–‡ä»¶ä¸Šä¼ é…ç½®ï¼ˆSpring Bootå†…ç½®ï¼‰
  servlet:
    multipart:
      enabled: true
      max-file-size: 50MB
      max-request-size: 50MB
      file-size-threshold: 2KB

# æœåŠ¡å™¨é…ç½®
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path:  # âš ï¸ é‡è¦ï¼šæ¸…ç©ºè¿™ä¸ªï¼ä¿æŒä¸ºç©ºå­—ç¬¦ä¸²
    # å› ä¸ºTestControllerå·²ç»æœ‰@RequestMapping("/api")äº†

# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    com.zaxxer.hikari: DEBUG
    org.postgresql: INFO
    org.postgresql.jdbc: INFO
    com.smartcampus: DEBUG
    com.smartcampus.controller.AiQaController: TRACE
    org.springframework.web: DEBUG
    org.springframework.web.multipart: TRACE
    org.springframework.web.multipart.support: TRACE
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql: WARN
  file:
    name: /var/log/smart-campus/backend-detailed.log
  logback:
    rollingpolicy:
      max-file-size: 10MB
      max-history: 30

# JWTé…ç½®
jwt:
  secret: smart-campus-jwt-secret-key-2024-change-this-in-production
  expiration: 86400000  # 24å°æ—¶ï¼Œå•ä½æ¯«ç§’

# AIç›¸å…³é…ç½®
ai:
  qianwen:
    api-key: ${AI_QIANWEN_API_KEY:sk-131e010e2b4a4fd3a7c41ef3e3ae10d8}
    api-url: ${AI_QIANWEN_API_URL:https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions}
    timeout: 90000
    model: qwen-max  # å›ºå®šæ¨¡å‹ï¼ŒæŒ‰ä½ è¦æ±‚

  embedding:
    model: text-embedding-v2
    chunk-size: 500
    chunk-overlap: 50

  rag:
    top-k: 3  # æ£€ç´¢æœ€ç›¸å…³çš„3ä¸ªç‰‡æ®µ
    similarity-threshold: 0.7  # ç›¸ä¼¼åº¦é˜ˆå€¼

  task:
    timeout: 300000  # 5åˆ†é’Ÿè¶…æ—¶
    max-concurrent: 10

# è‡ªå®šä¹‰æ–‡ä»¶ä¸Šä¼ é…ç½®ï¼ˆä¾›ä¸šåŠ¡ä»£ç ä½¿ç”¨ï¼‰
file:
  upload:
    max-size: 50MB
    allowed-types: pdf,doc,docx,txt
    storage:
      location: /opt/smart-campus/uploads

# ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true
      db:
        enabled: true